generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             Int                     @id @default(autoincrement())
  email          String?                 @unique
  name           String?
  walletAddress  String                  @unique
  homeAddress    String?
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  cart           Cart?
  orders         Order[]
  recentlyViewed RecentlyViewedProduct[]

  @@map("users")
}

model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

model Cart {
  id        Int        @id @default(autoincrement())
  userId    Int        @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  cartItems CartItem[]
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("carts")
}

model Seller {
  id              Int       @id 
  shopName        String
  walletAddress   String    @unique
  businessEmail   String    @unique
  password        String
  contactNumber   String?
  businessAddress String?
  logoImg         String?
  description     String?
  kybDocuments    String?
  kybStatus       KYBStatus @default(PENDING)
  isApproved      Boolean   @default(false)
  approvedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  api_key         String?   @unique
  store_id        Int?      @unique
  products        Product[]

  @@map("sellers")
}

model Product {
  id          Int         @id @default(autoincrement())
  name        String
  description String
  price       Int
  quantity    Int         @default(0)
  category    String
  image1      String
  image2      String?
  image3      String?
  sellerId    Int
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  cartItems   CartItem[]
  orderItems  OrderItem[]
  seller      Seller      @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  @@index([sellerId])
  @@index([category])
  @@map("products")
}

model CartItem {
  id           Int      @id @default(autoincrement())
  quantity     Int      @default(1)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  cartId       Int
  variantId    String?
  productImg   String
  productName  String
  productPrice Int
  productId    Int
  cart         Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([cartId])
  @@index([productId])
  @@map("cart_items")
}

model Order {
  id         Int         @id @default(autoincrement())
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  userId     Int
  orderItems OrderItem[]
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("orders")
}

model OrderItem {
  id              Int         @id @default(autoincrement())
  quantity        Int         @default(1)
  orderId         Int
  variantId       String?
  productImg      String
  productPrice    Int
  productName     String
  status          OrderStatus @default(PENDING_PAYMENT)
  totalAmount     Int?
  deliveryAddress String
  userEmail       String
  city            String
  zipCode         String
  state           String
  country         String
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  productId       Int
  order           Order       @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product         Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model Review {
  id           Int      @id @default(autoincrement())
  rating       Int
  comment      String?
  productId    Int
  reviewerName String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([productId])
  @@map("reviews")
}

model RecentlyViewedProduct {
  id           Int      @id @default(autoincrement())
  userId       Int
  productId    Int
  storeId      Int
  productName  String
  productImg   String
  productPrice Int
  variantId    String?
  viewedAt     DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, viewedAt])
  @@map("recently_viewed_products")
}

enum OrderStatus {
  PENDING_PAYMENT
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum KYBStatus {
  PENDING
  APPROVED
  REJECTED
  UNDER_REVIEW
}

enum PaymentMethod {
  ETH
  BTC
}